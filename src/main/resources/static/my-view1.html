<link rel="import" href="bower_components/polymer/polymer.html" />
<link rel="import" href="bower_components/polymer-ts/polymer-ts.html" />
<link rel="import" href="bower_components/paper-map-info/paper-map-info.html" />
<link rel="import" href="bower_components/google-map/google-map.html" />
<link rel="import" href="bower_components/google-map/google-map-marker.html" />
<link rel="import" href="bower_components/iron-ajax/iron-ajax.html" />
<link rel="import" href="bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="bower_components/iron-icon/iron-icon.html">
<link rel="import" href="bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="bower_components/paper-button/paper-button.html">
<link rel="import" href="bower_components/paper-dialog-behavior/paper-dialog-behavior.html">
<link rel="import" href="bower_components/paper-styles/color.html">
<link rel="import" href="bower_components/paper-styles/demo-pages.html">
<link rel="import" href="bower_components/neon-animation/neon-animations.html">
<link rel="import" href="my-icons.html" />
<link rel="import" href = "css/main.css" />
<link rel="import" href="shared-styles.html" />
<dom-module id="my-view1">
  <template id="pop">
    <style include="shared-styles">
      :host {
        display: block;
        padding: 10px;
      }

      #mapid{
        display:block;
        height:90vh;
      }

    </style>
      <iron-ajax

              id='ajaxId'
              method="POST"
              handle-as="text"
              on-response="handleResponse"
              contentType="application/json"
              last-response="{{ajaxResponse}}">
      </iron-ajax>

      <iron-ajax
              id='ajaxWeather'
              method="GET"

              handle-as="json"
              on-response="handleWeather"
              contentType="application/json"
              last-response="{{ajaxResponse1}}">
      </iron-ajax>


    <!--<google-map on-google-map-ready="_mapReady" fit-to-markers>
  <template is="dom-repeat" items="[[friends]]" as="f">
    <google-map-marker >
    </google-map-marker>
  </template>
  <paper-map-info id="myinfocard" fade-in>
    <div class="layout horizontal">
      <img src$="[[selectedFriend.picture]]" alt$="[[selectedFriend.name]]" >
      <paper-icon-button icon="communication:chat" on-tap="_startFriendChat"></paper-icon-button>
    </div>
  </paper-map-info>
  </google-map>-->

    <div id="wrapper">

        <!--<paper-button raised onclick="dialogopen">plain dialog</paper-button>


        <paper-dialog id="dialog">
            <h2>Dialog Title</h2>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute
                irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
        </paper-dialog>-->



    <div id="mapid">
    <google-map id="map" click-events = "true" latitude="45.973332" longitude="-103.502332" fit-to-markers on-click="fg" map="{{map}}" api-key="AIzaSyDbDxZvaQJ5QPYwhWSXn0WWKIxIhhMfups">
     <!-- <template is="dom-repeat" items="[[friends]]" as="f">-->
        <google-map-marker  hidden="true"  click-events = "true" latitude="{{lati}}" longitude="{{longi}}" on-latitude-changed="markerClick">

      </google-map-marker>
      <!--</template>-->
      <paper-map-info id="myinfocard" style="padding:2px; opacity:0.8" fade-in>
        <div style="padding:2px" id="infomap">

        </div>
      </paper-map-info>
    </google-map>

    </div>
    <!--<div style="display: block;
    float: right;
    z-index: 3;
    position: absolute; /*newly added*/
    margin:10px;
	padding:15px;

	-webkit-box-shadow:
		8px 10px 10px rgba(0,0,0,0.5),
		inset 8px 10px 10px rgba(255,255,255,0.75);
	-moz-box-shadow:
		8px 10px 10px rgba(0,0,0,0.5),
		inset 8px 10px 10px rgba(255,255,255,0.75);
	box-shadow:
		8px 10px 10px rgba(0,0,0,0.5),
		inset 8px 10px 10px rgba(255,255,255,0.75);
	background:#ccc;    right: 15px; /*newly added*/
    top: -310px;/*newly added*/;margin-bottom=-330px"
         id="over_map">
      Weather : {{ajaxResponse}}
    </div>-->
    </div>

  </template>
  <script>

    Polymer({
      is: 'my-view1',

      properties:{
      contents : Number,
          weather : {
              type : Object
          },
           lat : Number,
          long : Number,
 selectedSalon : {
          type : Object
          },
           map : {
          type : Object
        },
          lati : {
              type : Number
          },
         longi : {
              type : Number
          }

      },

        dialogopen : function(){

                this.$.dialog.open();

        },

      fg: function() {
          var fk = this.contents;
          var wk = this.weather;
          //var marker = document.createElement('google-map-marker');
          var xhrWeather = this.$$('#ajaxWeather');
          var t = document.querySelector('#pop');
          var xhr = this.$$('#ajaxId');
          var infoOnMap = this.$$('#infomap');
          var url = 'http://localhost:8080/point/getElevatio';
          xhr.url = encodeURI(url);
          xhr.headers={"Accept": "*/*", "Content-Type": "application/json"};
        var iwindow = new google.maps.InfoWindow();



        google.maps.event.addListener(this.map, 'click', function(e) {


          var latitude = e.latLng.lat();
          this.lat = latitude;

          var longitude = e.latLng.lng();
            this.long = longitude;


            this.longi = longitude;
            this.lati = latitude;

            xhr.body = {
                "type": "Point",
                "coordinates": [this.long , this.lat ]
            };
            xhr.generateRequest();
            /*localhost:8080/weather/id?lat=45.96&lon=-103.50&date=2017-06-22T8:40:00Z*/
            var weatherurl = "http://localhost:8080/weather/id?lat="+latitude+"&lon="+ longitude + "&date=2017-06-22T8:40:00Z";
            xhrWeather.url = encodeURI(weatherurl);
            xhrWeather.generateRequest();

            fk = this.contents;
            wk = this.weather;
          var uluru = {lat: latitude, lng: longitude};

          //iwindow.setContent(fk);
            var infoContents = Math.round(parseFloat(fk) * 100);
            var ind = infoContents/100;


            infoOnMap.innerHTML = "<b>Elevation</b> : " + ind + " meters  <br /><b>Weather : </b>" + wk.temperature_min_f + " F";

          iwindow.setPosition(uluru);
         // iwindow.open(this.map);
        }.bind(this));


      },

        ready: function () {
            if (this.long == undefined) {
                this.long = -71.32294714450836;
            }
            if (this.lat == undefined) {
                this.lat = 42.3601;
            }
        },

        /*attached: function () {
            var xhr = this.$$('#ajaxId');
            var url = 'http://localhost:8080/point/getElevatio';
            xhr.url = encodeURI(url);
            xhr.headers={"Accept": "*!/!*", "Content-Type": "application/json"};
            xhr.body = {
                "type": "Point",
                "coordinates": [this.lat , this.long ]
            };

            xhr.generateRequest();
        },*/


        handleResponse : function(e){
          this.contents = e.detail.response;
        },
        handleWeather : function(e){
            this.weather = e.detail.response;
            console.log(e.detail.response);
        },

        markerClick: function(e) {

            //this.selectedSalon = e.model.get('s');
            this.$.myinfocard.showInfoWindow(e.srcElement.marker);
        },

        _startFriendChat: function(e) {/*
        ... do something with this.selectedFriend to chat*/
        }

    });

  </script>
</dom-module>